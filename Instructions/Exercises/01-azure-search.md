---
lab:
  title: إنشاء حل Azure AI Search
  module: Module 12 - Creating a Knowledge Mining Solution
---

# إنشاء حل Azure AI Search

تعتمد جميع المنظمات على المعلومات لاتخاذ القرارات والإجابة على الأسئلة والعمل بكفاءة. والمشكلة بالنسبة لمعظم المنظمات ليست نقص المعلومات، بل في التحدي المتمثل في العثور على المعلومات واستخراجها من مجموعة ضخمة من الوثائق وقواعد البيانات وغيرها من المصادر التي تخزن فيها المعلومات.

على سبيل المثال، افترض أن *Margie's Travel* هي وكالة سفر متخصصة في تنظيم الرحلات إلى المدن حول العالم. بمرور الوقت، جمعت الشركة كمية كبيرة من المعلومات في وثائق مثل الكتيبات، فضلا عن تقييمات للفنادق مقدمة من قبل العملاء. هذه البيانات هي مصدر قيم لنتائج التحليلات لوكلاء السفر والعملاء أثناء تخطيطهم للرحلات، ولكن الحجم الهائل للبيانات يمكن أن يجعل من الصعب العثور على معلومات ذات صلة للإجابة على سؤال معين من العملاء.

لمواجهة هذا التحدي، يمكن لـ Margie's Travel استخدام Azure AI Search لتنفيذ حل تتم فيه فهرسة المستندات وإثراءها باستخدام مهارات الذكاء الاصطناعي لتسهيل البحث عنها.

## إنشاء موارد Azure

الحل الذي ستقوم بإنشائه لـ Margie's Travel يتطلب الموارد التالية في اشتراك Azure الخاص بك:

- مورد **بحث الذكاء الاصطناعي في Azure** الذي سيدير ​​الفهرسة والاستعلام.
- مورد **خدمات الذكاء الاصطناعي في Azure**، والذي يوفر خدمات الذكاء الاصطناعي للمهارات التي يمكن أن يستخدمها حل البحث الخاص بك لإثراء البيانات في مصدر البيانات باستخدام نتائج التحليلات التي تم إنشاؤها بالذكاء الاصطناعي.
- **حساب التخزين** مع حاوية كائن ثنائي كبير الحجم يتم فيها تخزين المستندات التي سيتم البحث عنها.

> **مهم**: يجب أن تكون موارد خدمات Azure AI Search والذكاء الاصطناعي في Azure في الموقع نفسه!

### إنشاء مورد كلام الذكاء الاصطناعي في Azure

1. في مستعرض ويب، افتح مدخل Azure في `https://portal.azure.com`، ثم سجل الدخول باستخدام حساب Microsoft المقترن باشتراك Azure لديك.
2. اضغط على زر **&#65291;Create a resource** وابحث عن *بحث عن*، وأنشئ مورد **Azure AI Search** باستخدام الإعدادات التالية:
    - **Subscription**: *اشتراكك في Azure*
    - **مجموعة الموارد**: *أنشئ مجموعة موارد (إذا كنت تستخدم اشتراكاً مقيداً، فقد لا يكون لديك إذن لإنشاء مجموعة موارد جديدة - استخدم المجموعة المتوفرة)*
    - **اسم الخدمة**: *أدخل اسماً فريداً*
    - **الموقع**: *تحديد موقع- لاحظ أنه يجب أن تكون موارد خدمات Azure AI Search والذكاء الاصطناعي في Azure في الموقع نفسه*
    - **مستوى التسعير**: أساسي

3. انتظر حتى يكتمل النشر، ثم انتقل إلى المورد المنشور.
4. راجع صفحة**نظرة عامة** على الجزء لمورد Azure AI Search في مدخل Microsoft Azure. هنا، يمكنك استخدام واجهة مرئية لإنشاء المكونات المختلفة لحل البحث واختبارها وإدارتها ومراقبتها؛ بما في ذلك مصادر البيانات والفهارس والمفهرسات ومجموعات المهارات.

### إنشاء مورد خدمات الذكاء الاصطناعي في Azure

إذا لم يكن لديك بالفعل مورد في اشتراكك، فسيتعين عليك توفير مورد **خدمات الذكاء الاصطناعي في Azure**. سيستخدم حل البحث الخاص بك هذا لإثراء البيانات الموجودة في مخزن البيانات بالرؤى التي تم إنشاؤها بواسطة الذكاء الاصطناعي.

1. ارجع إلى الصفحة الرئيسية لمدخل Azure، ثم حدد الزر **&#65291;Create a resource**، وابحث عن *Azure AI Services*، وأنشئ مورد **Azure AI Services** من خلال الإعدادات التالية:
    - **Subscription**: *اشتراكك في Azure*
    - **مجموعة الموارد**: *مجموعة الموارد نفسها مثل مورد بحث الذكاء الاصطناعي في Azure الخاص بك*
    - **المنطقة**: *الموقع نفسه كمورد بحث الذكاء الاصطناعي في Azure الخاص بك*
    - **الاسم**: *أدخل اسماً فريداً*
    - **مستوى التسعير**: قياسي S0
2. حدد مربعات الاختيار المطلوبة ثم أنشئ المورد.
3. انتظر حتى يكتمل النشر، ثم اعرض تفاصيل النشر.

### إنشاء حساب تخزين

1. ارجع إلى الصفحة الرئيسية لمدخل Microsoft Azure، ثم حدد الزر **&#65291;Create a resource**، وابحث عن *storage account*، وأنشئ مورد **Storage account** من خلال الإعدادات التالية:
    - **Subscription**: *اشتراكك في Azure*
    - **مجموعة الموارد**: **مجموعة الموارد نفسها مثل موارد خدمات Azure AI Search والذكاء الاصطناعي في Azure*
    - **اسم حساب التخزين**: *أدخل اسماً فريداً*
    - **المنطقة**: *اختر أي منطقة متوفرة*
    - **الأداء:** قياسي
    - **النسخ المتماثل**: التخزين المتكرر محلياً (LRS)
    - في علامة التبويب**خيارات متقدمة**، حدد المربع الموجود بجانب *السماح بتمكين الوصول المجهول على حاويات فردية*
2. انتظر حتى يكتمل النشر، ثم انتقل إلى المورد المنشور.
3. في **صفحة نظرة عامة**، لاحظ **معرف الاشتراك** - يحدد هذا الاشتراك الذي يتم توفير حساب التخزين فيه.
4. في صفحة **الوصول إلى المفاتيح**، لاحظ أنه تم إنشاء مفتاحين لحساب التخزين الخاص بك. ثم حدد **إظهار المفاتيح** لعرض المفاتيح.

    > **تلميح**: حافظ على شفرة **حساب التخزين** مفتوحة - ستحتاج إلى معرف الاشتراك وأحد المفاتيح في الإجراء التالي.

## الاستعداد لتطوير تطبيق في تعليمة Visual Studio البرمجية

ستطور تطبيق البحث لديك باستخدام Visual Studio Code. تم توفير ملفات التعليمات البرمجية لتطبيقك في GitHub repo.

> **تلميح**: إذا نسخت بالفعل مستودع **mslearn-knowledge-mining**، فافتحه في Visual Studio code. وإلا فاتبع هذه الخطوات لاستنساخه إلى بيئة تطويرك.

1. ابدأ تشغيل Visual Studio Code.
1. افتح لوحة (SHIFT+CTRL+P) وشغّل **Git: استنسخ الأمر ** لاستنساخ مستودع `https://github.com/MicrosoftLearning/mslearn-knowledge-mining` إلى مجلد محلي (لا يُهم أي مجلد).
1. عند استنساخ المستودع، افتح المجلد في تعليمة Visual Studio البرمجية.
1. انتظر حتى تثبيت ملفات إضافية لدعم مشاريع التعليمات البرمجية C# في المستودع.

    > **ملاحظة**: إذا جرت مطالبتك بإضافة الأصول المطلوبة للبناء وتصحيح الأخطاء، فحدد **ليس الآن**.

## تحميل المستندات إلى Azure Storage

الآن بعد أن أصبح لديك الموارد المطلوبة، يمكنك تحميل بعض المستندات إلى حساب Azure Storage الخاص بك.

1. في Visual Studio Code، في جزء** Explorer**، قم بتوسيع مجلد**مجلد Labfiles\01-azure-search** وحدد **UploadDocs.cmd**.
2. قم بتحرير ملف الدُفعات لاستبدال العناصر النائبة ** YOUR_SUBSCRIPTION_ID **،**وYOUR_AZURE_STORAGE_ACCOUNT_NAME** و**YOUR_AZURE_STORAGE_KEY** بمعرف الاشتراك المناسب واسم حساب تخزين Azure وقيم مفتاح حساب تخزين Azure لحساب التخزين الذي قمت بإنشائه مسبقًا.
3. احفظ التغييرات، ثم انقر بزر الماوس الأيمن فوق المجلد** 01-azure-search** وافتح محطة طرفية متكاملة.
4. أدخل الأمر التالي لتسجيل الدخول إلى اشتراك Azure باستخدام Azure CLI.

    ```powershell
    az login
    ```

    سيتم فتح علامة تبويب مستعرض ويب ومطالبتك بتسجيل الدخول إلى Azure. قم بذلك، ثم أغلق علامة تبويب المستعرض وارجع إلى Visual Studio Code.

5. أدخل الأمر التالي لتشغيل ملف الدُفعات. سيؤدي ذلك إلى إنشاء حاوية كائن ثنائي كبير الحجم في حساب التخزين الخاص بك وتحميل المستندات في مجلد **البيانات** إليها.

    ```powershell
    UploadDocs
    ```

## فهرسة المستندات

الآن بعد أن أصبح لديك المستندات في مكانها، يمكنك إنشاء حل بحث عن طريق فهرستها.

1. في مدخل Microsoft Azure، استعرض وصولاً إلى مورد بحث الذكاء الاصطناعي في Azure. ثم، في صفحة **النظرة العامة،** حدد **استيراد البيانات**.
2. في صفحة **الاتصال ببياناتك**، في قائمة **مصدر البيانات**، حدد **Azure Blob Storage**. ثم أكمل تفاصيل مخزن البيانات بالقيم التالية:
    - **Data Source**: Azure Blob Storage
    - **اسم مصدر البيانات**: margies-data
    - **البيانات المراد استخراجها**: المحتوى وبيانات التعريف
    - **وضع التحليل**: افتراضي
    - **سلسلة الاتصال**: *حدد رابط** Choose an existing connection.** ثم حدد حساب التخزين الخاص بك، وأخيرًا حدد حاوية **margies** التي تم إنشاؤها بواسطة البرنامج النصي UploadDocs.cmd.*
    - **مصادقة الهوية المُدارة**: لا شيء
    - **اسم الحاوية**: margies
    - **مجلد الكائنات الثنائية كبيرة الحجم**: *اترك هذا فارغاً*
    - **الوصف**: كتيبات وتقييمات في موقع Margie's Travel على الويب.
3. تابع إلى الخطوة التالية *إضافة مهارات معرفية*.
4. في قسم **إرفاق خدمات الذكاء الاصطناعي في Azure** حدد مورد خدمات الذكاء الاصطناعي في Azure.
5. في القسم **إضافة إثراءات**:
    - غيّر **اسم مجموعة المهارات** إلى **margies-skillset**.
    - حدد الخيار **تمكين OCR ودمج كل النص في حقل merged_content**.
    - تأكد من تعيين **حقل بيانات المصدر** إلى **merged_content**.
    - اترك مستوى** تفاصيل الإثراء **كحقل **مصدر** الذي يتم تعيين محتويات المستند بالكامل التي تتم فهرستها؛ ولكن لاحظ أنه يمكنك تغيير ذلك لاستخراج المعلومات على مستويات أكثر دقة، مثل الصفحات أو الجمل.
    - حدد الحقول الغنية التالية:

        | المهارة المعرفية | المعلمة‬ | اسم الحقل |
        | --------------- | ---------- | ---------- |
        | استخراج أسماء المواقع | | المواقع |
        | استخراج العبارات الرئيسية | | keyphrases |
        | اكتشاف اللغة | | اللغة |
        | إنشاء علامات من الصور | | imageTags |
        | إنشاء تسميات توضيحية من الصور | | imageCaption |

6. تحقق مرة أخرى من اختياراتك (قد يكون من الصعب تغييرها لاحقاً). ثم انتقل إلى الخطوة التالية (*تخصيص الفهرس الهدف*).
7. غيّر **اسم الفهرس** إلى **margies-index**.
8. تأكد من تعيين **المفتاح** على **metadata_storage_path** واترك **اسم المقترح فارغاً ووضع البحث ****على الوضع الافتراضي**.
9. قم بإجراء التغييرات التالية على حقول الفهرس، مع ترك جميع الحقول الأخرى بإعداداتها الافتراضية (**مهم**: قد تحتاج إلى التمرير إلى اليمين لرؤية الجدول بالكامل):

    | اسم الحقل | قابل للاسترداد | قابل للتصفية | قابل للفرز | قابلة لتشكيل الواجهة | قابل للبحث |
    | ---------- | ----------- | ---------- | -------- | --------- | ---------- |
    | metadata_storage_size | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10004; | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10004; | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10004; | | |
    | metadata_storage_last_modified | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10004; | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10004; | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10004; | | |
    | metadata_storage_name | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10004; | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10004; | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10004; | | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10004; |
    | metadata_author | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10004; | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10004; | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10004; | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10004; | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10004; |
    | المواقع | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10004; | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10004; | | | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10004; |
    | keyphrases | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10004; | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10004; | | | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10004; |
    | اللغة | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10004; | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10004; | | | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10004; |

10. تحقق جيدًا من اختياراتك، مع إيلاء اهتمام خاص للتأكد من تحديد الخيارات الصحيحة **Retrievable**،**وFilterable**،**وSortable**،**وFacetable**و **Searchable** لكل حقل (قد يكون من الصعب تغييرها لاحقًا). ثم تابع إلى الخطوة التالية (*إنشاء مفهرس*).
11. غيّر **اسم المفهرس** إلى **margies-index**.
12. اترك **الجدول** معيناً على **مرة واحدة**.
13. قم بتوسيع الخيارات **المتقدمة**، وتأكد من تحديد الخيار **مفاتيح الترميز Base-64** (تجعل مفاتيح الترميز الفهرس أكثر كفاءة بشكل عام).
14. حدد **إرسال** لإنشاء مصدر البيانات ومجموعة المهارات والفهرس والمفهرس. يتم تشغيل المفهرس تلقائياً ويقوم بتشغيل خط أنابيب الفهرسة، والذي:
    1. يستخرج محتويات وحقول بيانات تعريف الوثيقة من مصدر البيانات
    2. يدير مجموعة مهارات المهارات المعرفية لإنشاء حقول إضافية غنية
    3. يعين الحقول المستخرجة إلى الفهرس.
15. في النصف السفلي من صفحة **نظرة عامة** لمورد Azure AI Search خاصتك، اطلع على علامة التبويب **المفهرس**، والتي يجب أن تعرض **margies-indexer** المُنشأة حديثاً. انتظر بضع دقائق، ثم انقر فوق **&orarr;تحديث** حتى تشير **الحالة** إلى نجاح.

## البحث في الفهرس

الآن بعد أن أصبح لديك فهرس، يمكنك البحث فيه.

1. في أعلى صفحة **نظرة عامة**، لمورد Azure AI Search خاصتك، حدد **مستكشف البحث**.
2. في مستكشف البحث، في مربع **سلسلة الاستعلام**، أدخل `*` (علامة نجمية واحدة)، ثم حدد **بحث**.

    يسترد هذا الاستعلام جميع المستندات في الفهرس بتنسيق JSON. افحص النتائج ولاحظ الحقول الخاصة بكل مستند، والتي تحتوي على محتوى المستند وبيانات التعريف والبيانات التي تم إثراؤها المستخلصة من المهارات المعرفية التي حددتها.

3. في قائمة **العرض**، حدد **طريقة عرض JSON** ولاحظ ظهور طلب JSON للبحث، مثل هذا:

    ```json
    {
      "search": "*"
    }
    ```

1. قم بتعديل طلب JSON ليتضمن معلمة **العد** كما هو موضح هنا:

    ```json
    {
      "search": "*",
      "count": true
    }
    ```

1. أرسل البحث المعدل. هذه المرة، تتضمن النتائج حقلًا**@odata.count** في أعلى النتائج يشير إلى عدد المستندات التي تم إرجاعها بواسطة البحث.

4. جرّب الاستعلام التالي:

    ```json
    {
      "search": "*",
      "count": true,
      "select": "metadata_storage_name,metadata_author,locations"
    }
    ```

    تتضمن النتائج هذه المرة فقط اسم الملف والكاتب وأي مواقع مذكورة في محتوى المستند. يوجد اسم الملف والكاتب في حقلي **metadata_storage_name** و **metadata_author**، اللذين تم استخلاصهما من مستند المصدر. تم إنشاء حقل**المواقع** بواسطة مهارة معرفية.

5. الآن جرب سلسلة الاستعلام التالية:

    ```json
    {
      "search": "New York",
      "count": true,
      "select": "metadata_storage_name,keyphrases"
    }
    ```

    يبحث هذا البحث عن المستندات التي تشير إلى "نيويورك" في أي من الحقول القابلة للبحث، ويعيد اسم الملف والعبارات الرئيسية في المستند.

6. دعنا نجرب استعلام آخر:

    ```json
    {
      "search": "New York",
      "count": true,
      "select": "metadata_storage_name",
      "filter": "metadata_author eq 'Reviewer'"
    }
    ```

    يقوم هذا الاستعلام بإرجاع اسم الملف لأي مستندات قام *المراجع*بتأليفها والتي تشير إلى "نيويورك".

## استكشاف وتعديل تعريفات مكونات البحث

تستند مكونات حل البحث إلى تعريفات JSON، والتي يمكنك عرضها وتعديلها في مدخل Microsoft Azure.

بينما يمكنك استخدام المدخل لإنشاء حلول البحث وتعديلها، غالبًا ما يكون من المستحسن تعريف كائنات البحث في JSON واستخدام REST لخدمة الذكاء الاصطناعي في Azure لإنشائها وتعديلها.

### الحصول على نقطة النهاية والمفتاح لمورد Azure AI Search resource خاصتك

1. في مدخل Microsoft Azure، ارجع إلى صفحة** نظرة عامة** لمورد Azure AI Search خاصتك، وفي القسم العلوي من الصفحة، ابحث عن **عنوان URL** للمورد لديك (الذي يشبه **https://resource_name.search.windows.net**) وانسخه إلى الحافظة.
2. في Visual Studio Code، في جزء Explorer، قم بتوسيع المجلد ** 01-azure-search** ومجلده الفرعي ** modify-search**، وحدد **modify-search.cmd** لفتحه. ستستخدم ملف البرنامج النصي هذا لتشغيل أوامر * cURL* التي ترسل JSON إلى واجهة REST لخدمة الذكاء الاصطناعي في Azure.
3. في **modify-search.cmd**، استبدل العنصر النائب** YOUR_SEARCH_URL** بعنوان URL الذي نسخته إلى الحافظة.
4. في مدخل Microsoft Azure، اعرض صفحة**المفاتيح** لمورد Azure AI Search لديك، وانسخ **مفتاح المسؤول الأساسي** إلى الحافظة.
5. في Visual Studio Code، استبدل العنصر النائب ** YOUR_ADMIN_KEY**بالمفتاح الذي نسخته إلى الحافظة.
6. احفظ التغييرات على **modify-search.cmd** (ولكن لا تقم بتشغيلها بعد!)

### مراجعة مجموعة المهارات وتعديلها

1. في Visual studio Code، في مجلد** modify-search**، افتح **skillset.json**. يظهر هذا تعريف JSON لمجموعة **margies-skillset**.
2. في أعلى تعريف مجموعة المهارات، لاحظ كائن ** cognitiveServices**، والذي يستخدم لتوصيل مورد خدمات الذكاء الاصطناعي في Azure بمجموعة المهارات.
3. في مدخل Microsoft Azure، افتح مورد خدمات الذكاء الاصطناعي في Azure (<u>وليس</u> مورد Azure AI Search!) واعرض صفحة** المفاتيح** الخاصة به. ثم انسخ **المفتاح 1**إلى الحافظة.
4. في Visual Studio Code، في **skillset.json**، استبدل العنصر النائب** YOUR_COGNITIVE_SERVICES_KEY** بمفتاح خدمات الذكاء الاصطناعي في Azure الذي نسخته إلى الحافظة.
5. قم بالتمرير عبر ملف JSON، مع ملاحظة أنه يتضمن تعريفات للمهارات التي أنشأتها باستخدام واجهة مستخدم Azure AI Search في مدخل Microsoft Azure. في أسفل قائمة المهارات، تمت إضافة مهارة إضافية باستخدام التعريف التالي:

    ```json
    {
        "@odata.type": "#Microsoft.Skills.Text.V3.SentimentSkill",
        "defaultLanguageCode": "en",
        "name": "get-sentiment",
        "description": "New skill to evaluate sentiment",
        "context": "/document",
        "inputs": [
            {
                "name": "text",
                "source": "/document/merged_content"
            },
            {
                "name": "languageCode",
                "source": "/document/language"
            }
        ],
        "outputs": [
            {
                "name": "sentiment",
                "targetName": "sentimentLabel"
            }
        ]
    }
    ```

    تسمى المهارة الجديدة** get-sentiment**، ولكل **مستوى مستند** في مستند، ستقوم بتقييم النص الموجود في الحقل** merged_content** للمستند الذي تتم فهرسته (والذي يتضمن المحتوى المصدر بالإضافة إلى أي نص مستخلص من الصور في المحتوى). ويستخدم اللغة** المستخلصة **للمستند (مع القيمة اللغة الإنجليزية بشكل افتراضي)، ويقيّم تسمية لتوجه المحتوى. يمكن أن تكون قيم تسمية التوجه "إيجابية" أو "سلبية" أو "محايدة" أو "مختلطة". ثم يتم إخراج هذه التسمية كحقل جديد يسمى **sentimentLabel**.

6. احفظ التغييرات التي أجريتها على**skillset.json**.

### مراجعة الفهرس وتعديله

1. في Visual studio Code، في مجلد** modify-search**، افتح **index.json**. يظهر هذا تعريف JSON لـ **margies-index**.
2. قم بالتمرير عبر الفهرس وشاهد تعريفات الحقول. تستند بعض الحقول إلى بيانات التعريف والمحتوى في المستند المصدر، وتستند الحقول الأخرى على نتائج المهارات في مجموعة المهارات.
3. في نهاية قائمة الحقول التي قمت بتعريفها في مدخل Microsoft Azure، لاحظ أنه تمت إضافة حقلين إضافيين:

    ```json
    {
        "name": "sentiment",
        "type": "Edm.String",
        "facetable": false,
        "filterable": true,
        "retrievable": true,
        "sortable": true
    },
    {
        "name": "url",
        "type": "Edm.String",
        "facetable": false,
        "filterable": true,
        "retrievable": true,
        "searchable": false,
        "sortable": false
    }
    ```

4. سيتم استخدام حقل**التوجه** لإضافة الإخراج من مهارة** get-sentiment** التي تمت إضافتها إلى مجموعة المهارات. سيتم استخدام حقل**url** لإضافة عنوان URL لكل مستند مفهرس إلى الفهرس، استنادًا إلى القيمة** metadata_storage_path** المستخلصة من مصدر البيانات. لاحظ أن الفهرس يتضمن بالفعل حقل ** metadata_storage_path**، ولكنه يستخدم كمفتاح فهرس والمرمز باستخدام Base-64، ما يجعله فعالاً كمفتاح ولكنه يتطلب من تطبيقات العميل فك ترميزه إذا كانوا يريدون استخدام قيمة URL الفعلية كحقل. تؤدي إضافة حقل ثان للقيمة غير المشفرة إلى حل هذه المشكلة.

### مراجعة المفهرس وتعديله

1. في Visual studio Code، في مجلد** modify-search**، افتح **indexer.json**. يعرض هذا تعريف JSON لمفهرس **margies-indexer**، الذي يعين الحقول المستخلصة من محتوى المستند وبيانات التعريف (في قسم** fieldMappings**)، والقيم المستخلصة بواسطة المهارات في مجموعة المهارات (في قسم** outputFieldMappings**)، إلى الحقول في الفهرس.
2. في قائمة ** fieldMappings**، لاحظ تعيين قيمة** metadata_storage_path** إلى حقل المفتاح المشفر باستخدام base-64. تم إنشاء هذا عند تعيين **metadata_storage_path** كمفتاح وتحديد خيار لترميز المفتاح في مدخل Microsoft Azure. بالإضافة إلى ذلك، يقوم التعيين الجديد بتعيين نفس القيمة بشكل صريح إلى حقل عنوان **url**، ولكن بدون ترميز Base-64:

    ```json
    {
        "sourceFieldName" : "metadata_storage_path",
        "targetFieldName" : "url"
    }    
    ```

    يتم تعيين كافة حقول بيانات التعريف والمحتوى الأخرى في المستند المصدر ضمنيًا إلى حقول بنفس الاسم في الفهرس.

3. راجع قسم** ouputFieldMappings**، الذي يعين المخرجات من المهارات في مجموعة المهارات إلى حقول الفهرس. يعكس معظم ذلك الخيارات التي قمت بها في واجهة المستخدم، ولكن تمت إضافة التعيين التالي لتعيين قيمة ** sentimentLabel** المستخلصة من مهارة التوجه الخاصة بك إلى حقل** التوجه **الذي أضفته إلى الفهرس:

    ```json
    {
        "sourceFieldName": "/document/sentimentLabel",
        "targetFieldName": "sentiment"
    }
    ```

### استخدام واجهة برمجة تطبيقات REST لتحديث حل البحث

1. انقر بزر الماوس الأيمن فوق مجلد **modify-search** وافتح محطة طرفية متكاملة.
2. في جزء الوحدة الطرفية لمجلد **modify-search**، أدخل الأمر التالي لتشغيل البرنامج النصي** modify-search.cmd**، الذي يرسل تعريفات JSON إلى واجهة REST ويبدأ الفهرسة.

    ```powershell
    ./modify-search
    ```

3. عند انتهاء البرنامج النصي، ارجع إلى صفحة **نظرة عامة** لمورد Azure AI Search في مدخل Microsoft Azure واعرض صفحة**المفهرسات**. حدد **تحديث** بشكل دوري لتتبع تقدم عملية الفهرسة. قد يستغرق الأمر دقيقة أو نحو ذلك حتى يكتمل.

    *قد تكون هناك بعض التحذيرات لبعض المستندات الكبيرة جدًا لتقييم التوجه. غالبًا ما يتم إجراء تحليل التوجه على مستوى الصفحة أو الجملة بدلاً من المستند بالكامل؛ ولكن في سيناريو هذه الحالة، فإن معظم المستندات - خاصة تقييمات الفندق، تكون قصيرة بما يكفي لتقييم درجات التوجه المفيدة على مستوى المستند.*

### الاستعلام عن الفهرس المعدل

1. في أعلى الجزء لمورد Azure الذكاء الاصطناعي Search، حدد **مستكشف البحث**.
2. في مستكشف البحث، في **مربع **سلسلة الاستعلام، أرسل استعلام JSON التالي:

    ```json
    {
      "search": "London",
      "select": "url,sentiment,keyphrases",
      "filter": "metadata_author eq 'Reviewer' and sentiment eq 'positive'"
    }
    ```

    يسترد هذا الاستعلام عنوان **URL** **والمشاعر** **وعبارات** المفاتيح لجميع المستندات التي تشير إلى *لندن* التي ألفها *المراجع* التي تحمل وصفا إيجابيا **للتوجه** (بمعنى آخر، المراجعات الإيجابية التي تذكر لندن)

3. **أغلق صفحة مستكشف البحث** للعودة إلى صفحة**نظرة عامة**.

## إنشاء تطبيق بحث للعميل

الآن بعد أن أصبح لديك فهرس مفيد، يمكنك استخدامه من تطبيق عميل. يمكنك القيام بذلك عن طريق استخدام واجهة REST، وإرسال الطلبات وتلقي الاستجابات بتنسيق JSON عبر HTTP؛ أو يمكنك استخدام مجموعة أدوات تطوير البرامج (SDK) للغة البرمجة المفضلة لديك. سنستخدم SDK، في هذا التمرين.

> **ملاحظة**: يمكنك اختيار استخدام SDK إما لـ **C#** أو **Python**. في الخطوات الواردة أدناه، نفذ الإجراءات المناسبة للغتك المفضلة.

### الحصول على نقطة النهاية والمفاتيح لمورد البحث خاصتك

1. في مدخل Microsoft Azure، في صفحة **نظرة عامة** لمورد Azure AI Search، لاحظ قيمة** Url**، والتي يجب أن تكون مشابهة لـ **https://*your_resource_name*.search.windows.net**. هذه هي نقطة النهاية لمورد البحث لديك.
2. في صفحة **المفاتيح**، لاحظ أن هناك مفتاحين **للمسؤول** ومفتاح استعلام**** واحد. *يتم استخدام مفتاح المسؤول* لإنشاء موارد البحث وإدارتها؛ ويتم استخدام مفتاح*الاستعلام* بواسطة تطبيقات العميل التي تحتاج فقط إلى إجراء استعلامات البحث.

    *ستحتاج إلى نقطة النهاية ومفتاح الاستعلام لتطبيق العميل الخاص بك.*

### الاستعداد لاستخدام Azure AI Search SDK

1. في Visual Studio Code، في جزء **Explorer**، استعرض للوصول إلى المجلد **01-azure-search** وقم بتوسيع المجلد **CSharp** أو **Python** حسب تفضيل اللغة لديك.
2. انقر بزر الماوس الأيمن فوق مجلد **margies-travel** وافتح محطة طرفية متكاملة. ثم عليك تثبيت حزمة Azure AI Search SDK عن طريق تشغيل الأمر المناسب لتفضيل اللغة لديك:

    **C#**

    ```
    dotnet add package Azure.Search.Documents --version 11.1.1
    ```

    **Python**

    ```
    pip install azure-search-documents==11.0.0
    ```

3. اعرض محتويات مجلد **margies-travel**، ولاحظ أنه يحتوي على ملف لإعدادات التكوين:
    - **C#**: appsettings.json
    - **Python**: .env

    افتح ملف التكوين وقم بتحديث قيم التكوين التي يحتوي عليها لتعكس **نقطة النهاية** و**مفتاح الاستعلام** لمورد Azure AI Search. احفظ تغييراتك.

### استكشاف التعليمات البرمجية للبحث في فهرس

يحتوي مجلد** margies-travel** على ملفات تعليمات برمجية لتطبيق ويب (تطبيق ويب Microsoft C# *ASP.NET Razor* أو تطبيق Python *Flask*)، والذي يتضمن وظائف البحث.

1. افتح ملف التعليمات البرمجية التالي في تطبيق الويب، اعتمادًا على اختيارك للغة البرمجة:
    - **C#**:Pages/Index.cshtml.cs
    - **Python**: app.py
2. بالقرب من أعلى ملف التعليمات البرمجية، ابحث عن التعليق **استيراد مساحات أسماء البحث**، ولاحظ مساحات الأسماء التي تم استيرادها للعمل مع Azure AI Search SDK:
3. في الدالة **search_query**، ابحث عن التعليق **إنشاء عميل بحث**، ولاحظ أن التعليمات البرمجية تنشئ كائن **SearchClient** باستخدام نقطة النهاية ومفتاح الاستعلام لمورد Azure AI Search لديك:
4. في الدالة **search_query**، ابحث عن التعليق **إرسال استعلام بحث**، وراجع التعليمات البرمجية لإرسال بحث عن النص المحدد باستخدام الخيارات التالية:
    - تم العثور على *وضع بحث* يتطلب **كل**الكلمات الفردية في نص البحث.
    - يتم تضمين العدد الإجمالي للمستندات التي تم العثور عليها عن طريق البحث في النتائج.
    - تتم تصفية النتائج لتضمين فقط المستندات التي تطابق تعبير عامل التصفية المقدّم.
    - يتم فرز النتائج في ترتيب الفرز المحدد.
    - يتم إرجاع كل قيمة منفصلة لحقل ** metadata_author** *كواجهة* والتي يمكن استخدامها لعرض قيم محددة مسبقًا للتصفية.
    - يتم تضمين ما يصل إلى ثلاثة مستخلصات من حقول ** merged_content** و **imageCaption** مع كون مصطلحات البحث المضمنة في النتائج.
    - تتضمن النتائج الحقول المحددة فقط.

### استكشاف التعليمات البرمجية لعرض نتائج البحث

يتضمن تطبيق الويب بالفعل تعليمة برمجية لمعالجة نتائج البحث وعرضها.

1. افتح ملف التعليمات البرمجية التالي في تطبيق الويب، اعتمادًا على اختيارك للغة البرمجة:
    - **C#**:Pages/Index.cshtml
    - **Python**: templates/search.html
2. افحص التعليمات البرمجية التي تعرض الصفحة التي يتم عرض نتائج البحث عليها. لاحظ ما يلي:
    - تبدأ الصفحة بنموذج بحث يمكن للمستخدم استخدامه لإرسال بحث جديد (في إصدار Python للتطبيق، يتم تعريف هذا النموذج في قالب** base.html**)، والذي تتم الإشارة إليه في بداية الصفحة.
    - ثم يتم عرض نموذج ثان، مما يمكن المستخدم من تحسين نتائج البحث. التعليمات البرمجية لهذا النموذج:
        - استرداد عدد المستندات وعرضها من نتائج البحث.
        - استرداد قيم الواجهة لحقل **metadata_author** وعرضها كقائمة خيار للتصفية.
        - إنشاء قائمة منسدلة لخيارات الفرز للنتائج.
    - ثم تتكرر التعليمات البرمجية من خلال نتائج البحث، مع عرض كل نتيجة على النحو التالي:
        - **عرض حقل metadata_storage_name** (اسم الملف) كارتباط إلى العنوان في حقل** url**.
        - عرض*النقاط البارزة* لمصطلحات البحث الموجودة في حقلي** merged_content** و **imageCaption** للمساعدة في إظهار مصطلحات البحث في السياق.
        - عرض حقول **metadata_author**و**metadata_storage_size**و**metadata_storage_last_modified** و **اللغة**.
        - عرض تسمية**التوجه** للمستند. يمكن أن تكون إيجابية أو سلبية أو محايدة أو مختلطة.
        - عرض أول خمس **عبارات أساسية** (إن وجدت).
        - عرض أول خمسة **مواقع** (إن وجدت).
        - عرض أول خمس ** علامات الصورة**(إن وجدت).

### شغّل تطبيق الويب

 1. أعد الوحدة الطرفية المتكاملة للمجلد **margies-travel**، وأدخل الأمر التالي لتشغيل البرنامج:

    **C#**
    
    ```
    dotnet run
    ```
    
    **Python**
    
    ```
    flask run
    ```

2. في الرسالة التي يتم عرضها عند بدء تشغيل التطبيق بنجاح، اتبع الارتباط إلى تطبيق الويب قيد التشغيل (*http://localhost:5000/* أو *http://127.0.0.1:5000/*) لفتح موقع Margies Travel في مستعرض ويب.
3. على موقع Margie's Travel على الويب، أدخل **فندق لندن** في مربع البحث وانقر فوق **Search**.
4. راجع نتائج البحث. وهي تشمل اسم الملف (مع ارتباط تشعبي إلى عنوان URL للملف) ومستخرج من محتوى الملف مع التأكيد على مصطلحات البحث (*لندن* و*فندق*) والسمات الأخرى للملف من حقول الفهرس.
5. لاحظ أن صفحة النتائج تتضمن بعض عناصر واجهة المستخدم التي تمكنك من تحسين النتائج. يتضمن هذا ما يلي:
    - يستند*عامل تصفية* إلى قيمة واجهة لحقل **metadata_author**. يوضح هذا كيفية استخدامك حقول *قابلة لتشكيل الواجهة* لإرجاع قائمة من *الواجهات* - الحقول مع مجموعة صغيرة من القيم المنفصلة التي يمكن عرضها كقيم تصفية محتملة في واجهة المستخدم.
    - القدرة على *ترتيب *النتائج استنادًا إلى حقل محدد واتجاه الفرز (تصاعدي أو تنازلي). يستند الترتيب الافتراضي إلى *الصلة*، والتي يتم حسابها كقيمة **search.score()** استنادًا إلى *ملف تعريف التسجيل*الذي يقيّم تكرار وأهمية مصطلحات البحث في حقول الفهرس.
6. حدد عامل تصفية **المراجع** وخيار الفرز **الإيجابية إلى السلبية**، ثم حدد **تحسين النتائج**.
7. لاحظ أن النتائج تتم تصفيتها لتضمين التقييمات فقط، ويتم فرزها استنادًا إلى تسمية التوجه.
8. في **مربع البحث**، أدخل بحثًا جديدًا عن **فندق هادئ في نيويورك** وراجع النتائج.
9. جرب مصطلحات البحث التالية:
    - **برج لندن** (لاحظ أن هذا المصطلح يعرف على *أنه عبارة رئيسية* في بعض الوثائق).
    - **ناطحة السحاب** (لاحظ أن هذه الكلمة لا تظهر في المحتوى الفعلي لأي مستندات، ولكنها موجودة في *التسميات التوضيحية للصور* و*علامات الصور*التي تم إنشاؤها للصور في بعض المستندات).
    - **صحراء موهافي** (لاحظ أن هذا المصطلح محدد كـ *موقع* في بعض المستندات).
10. أغلق علامة تبويب المتصفح التي تحتوي على موقع ويب Margie's Travel وقم بالعودة إلى Visual Studio Code. ثم في وحدة Python الطرفية لمجلد **margies-travel** (حيث يتم تشغيل dotnet أو تطبيق flask)، أدخل Ctrl+C لوقف التطبيق.

## مزيد من المعلومات

للتعرّف على المزيد حول Azure AI Search، راجع [وثائق Azure AI Search](https://docs.microsoft.com/azure/search/search-what-is-azure-search).
